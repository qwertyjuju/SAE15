<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Résultats tcpdump</title>
        <link rel="icon" href="img/icon2.jpg">
		<link rel="stylesheet" href="css/fonts.css">
		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/sitecss.css">
        <script src="js/jquery.min.js"></script>
    </head>
    <body>
		<header>
			<div class="row">
				<div class="col-4">
					<img class="title-img" src="img/index.jpg">
				</div>
				<div class="col-4">
					<h1 class="title">Résultats TCPDUMP</h1>
				</div>
			</div>
		</header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container-fluid">
              <a class="navbar-brand" href="#">Navbar</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarColor01">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Acceuil
                        <span class="visually-hidden">(current)</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">adresses IP</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Ports</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">A propos</a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="container">
            <div class="row">
                <div class="openable-frame">
                    <div class="frame-title">
                        <div class="row">
                            <div class="col-6">
                                <h1>Compteur adresses IP</h1>
                            </div>
                            <div class="col-6">
                                <button class="button align-right" onclick="openframe(0)">-/+</button>
                            </div>
                        </div>
                    </div>
                    <div class="openable-frame-body" id="ipframe-all">
                    </div>
                </div>
            </div>
        </div>
		<footer class="bg-darkgray2">
        </footer>
        <script>
            /* openable frame */
            var elems = document.getElementsByClassName("openable-frame")
            var openableFrames = []
            for (elemnb in elems){
                try{
                    if (elems[elemnb].classList.contains("openable-frame")){
                        openableFrames.push(elems[elemnb])
                    }
                }
                catch (error){
                    if (error instanceof TypeError){}
                    else{
                        throw error
                    }
                }
            }
            openableFrames[0].getElementsByClassName("openable-frame-body")[0].classList.add("active");
            function openframe(i){
                if(openableFrames[i].getElementsByClassName("openable-frame-body")[0].classList.contains("active")){
                    openableFrames[i].getElementsByClassName("openable-frame-body")[0].classList.remove("active");
                }
                else{
                    openableFrames[i].getElementsByClassName("openable-frame-body")[0].classList.add("active");
                }
            }

            /* json data */
            var requestURL = window.location.href+"data.json";
            var ipFrameAll = document.getElementById('ipframe-all')
            console.log(requestURL, ipFrameAll);
            var request = new XMLHttpRequest();
            request.open('GET', requestURL);
            request.responseType = 'json';
            request.send();
            request.onload = function() {
                var jsondata = request.response;
                var totalIp = jsondata['_total']
                for(element in jsondata){
                    if(element!='_total'){
                        var nb = jsondata[element]
                        var percent = Math.ceil((nb*100)/totalIp)
                        create_progressbar(ipFrameAll, element, percent)
                    }
                }
            }
            console.log(ipFrameAll);
            function create_progressbar(frame, elementname, percent){
                if(elementname==''){
                    elementname='None'
                }
                var title= document.createElement("h5")
                title.innerText= elementname
                frame.appendChild(title)
                var progress = document.createElement("div")
                progress.classList.add('progress')
                progress.classList.add('progress-margin')
                var progressBar =document.createElement("div")
                progressBar.classList.add('progress-bar') 
                progressBar.classList.add('progress-bar-striped')
                progressBar.classList.add('progress-bar-animated')
                strpercent = "width: ".concat(percent,"%")
                progressBar.setAttribute("style", strpercent)
                progressBar.setAttribute("role", "progressbar")
                progressBar.setAttribute("aria-valuemin",0)
                progressBar.setAttribute("aria-valuemax",100)
                progressBar.setAttribute("aria-valuenow",percent)
                progress.appendChild(progressBar)
                frame.appendChild(progress)
            }
        </script>
		<script src="js/bootstrap.bundle.min.js"></script>
		<script src="js/prism.js" data-manual></script>
		<script src="js/custom.js"></script>
    </body>
</html>
